<UserControl x:Class="NRI.Controls.AdminWindowControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:local="clr-namespace:NRI.Controls"
             xmlns:converters="clr-namespace:NRI.Converters"
             Background="#FF252526">

    <UserControl.Resources>
        
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:BoolToStatusConverter x:Key="BoolToStatusConverter"/>
        
        <Style TargetType="Expander" BasedOn="{StaticResource MaterialDesignExpander}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Margin" Value="0 10 0 0"/>
            <Setter Property="Padding" Value="15 10"/>
            <Setter Property="materialDesign:ColorZoneAssist.Mode" Value="PrimaryMid"/>
            <Setter Property="HeaderTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="{Binding 
                                RelativeSource={RelativeSource AncestorType=Expander}, 
                                Path=Tag}" 
                                Margin="0 0 10 0"/>
                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="DataGrid" BasedOn="{StaticResource MaterialDesignDataGrid}">
            <Setter Property="Background" Value="#FF333337"/>
            <Setter Property="BorderBrush" Value="#FF444448"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Margin" Value="0 0 0 15"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="ColumnHeaderStyle">
                <Setter.Value>
                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                        <Setter Property="Foreground" Value="#D0D0D0"/>
                        <Setter Property="Background" Value="#FF2D2D30"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Padding" Value="10 8"/>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
            <Setter Property="Margin" Value="0 0 10 10"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="materialDesign:ButtonAssist.CornerRadius" Value="4"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <Border Grid.Row="0" Background="#FF2D2D30" Padding="20 15">
            <StackPanel Orientation="Horizontal">
                <materialDesign:PackIcon Kind="ShieldAccount" 
                                        Foreground="#FF4CAF50"
                                        Width="32"
                                        Height="32"
                                        Margin="0 0 15 0"/>
                <TextBlock Text="АДМИНИСТРИРОВАНИЕ" 
                           Foreground="White"
                           FontSize="24"
                           FontWeight="Bold"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Основной контент -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20">
            <StackPanel>
                <!-- Управление пользователями -->
                <Expander Header="Управление пользователями" 
                          Tag="AccountGroup" 
                          IsExpanded="True"
                          Foreground="DarkKhaki"
                          Background="Cornsilk">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Инструменты -->
                        <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0 0 0 15">
                            <TextBox Width="300" 
                                     materialDesign:HintAssist.Hint="Поиск пользователя..."
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                     Margin="0 0 10 0"/>

                            <Button Content="Фильтры"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Foreground="#FF4CAF50"/>
                        </StackPanel>

                        <!-- Таблица пользователей -->
                        <DataGrid Grid.Row="1" ItemsSource="{Binding Users}" AutoGenerateColumns="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Логин" Binding="{Binding Login}" />
                                <DataGridTextColumn Header="Email" Binding="{Binding Email}" />
                                <DataGridTemplateColumn Header="Статус" Width="100">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock Text="{Binding IsOnline, Converter={StaticResource BoolToStatusConverter}}"/>
                                                <Ellipse Width="10" Height="10" 
                                                 Fill="{Binding IsOnline, Converter={StaticResource BoolToColorConverter}}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Роль" Binding="{Binding Role}" />
                                <DataGridTextColumn Header="Последняя активность" 
                                Binding="{Binding LastActivity, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}" />
                            </DataGrid.Columns>
                        </DataGrid>
                        
                        <!-- Панель действий -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 15 0 0">
                            <Button Content="Добавить пользователя"
                                    Command="{Binding AddUserCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Background="#FF4CAF50"
                                    Foreground="White"
                                    Width="206"/>
                            

                            
                            <Button Content="Экспорт в CSV"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Foreground="#FF4CAF50"
                                    Margin="10 0 0 0" Width="137"/>

                            <Button Command="{Binding DataContext.DeleteUserCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"
                                    Style="{StaticResource MaterialDesignIconButton}"
                                    Foreground="#FFE53935"
                                    ToolTip="Удалить"
                                    Margin="5 0 0 0">
                                <materialDesign:PackIcon Kind="Delete" />
                                
                            </Button>
                        </StackPanel>
                    </Grid>
                </Expander>

                <!-- Игровые системы -->
                <Expander Header="Управление игровыми системами" 
                          Tag="DiceMultiple"
                          Background="Cornsilk"
                          Foreground="#FF4CAF50">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Инструменты -->
                        <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0 0 0 15">
                            <TextBox Width="300" 
                                     materialDesign:HintAssist.Hint="Поиск игровой системы..."
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                     Margin="0 0 10 0" />
                        </StackPanel>

                        <!-- Таблица игровых систем -->
                        <DataGrid Grid.Row="1" ItemsSource="{Binding GameSystems}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="Auto"/>
                                <DataGridTextColumn Header="Название" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="Версия" Binding="{Binding Version}" Width="120"/>
                                <DataGridTextColumn Header="Статус" 
                                                   Binding="{Binding IsOnline, Converter={StaticResource BoolToStatusConverter}}">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="Padding" Value="8 4"/>
                                            <Setter Property="Background" Value="{Binding Status, Converter={StaticResource StatusToBrushConverter}}"/>
                                            <Setter Property="Foreground" Value="DarkKhaki"/>
                                            <Setter Property="FontWeight" Value="Medium"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTemplateColumn Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <Button Style="{StaticResource MaterialDesignIconButton}"
                                                        Foreground="#FF4CAF50"
                                                        ToolTip="Редактировать"
                                                        Command="{Binding DataContext.EditSystemCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                        CommandParameter="{Binding}">
                                                    <materialDesign:PackIcon Kind="Pencil" />
                                                </Button>

                                                <Button Style="{StaticResource MaterialDesignIconButton}"
                                                        Foreground="#FFE53935"
                                                        ToolTip="Удалить"
                                                        Command="{Binding DataContext.DeleteSystemCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                        CommandParameter="{Binding}"
                                                        Margin="5 0 0 0">
                                                    <materialDesign:PackIcon Kind="Delete" />
                                                </Button>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Панель действий -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 15 0 0">
                            <Button Content="Добавить систему"
                                    Command="{Binding AddGameSystemCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Background="#FF4CAF50"
                                    Foreground="White"
                                    Width="162"/>

                            <Button Content="Импорт шаблонов"
                                    Command="{Binding ImportTemplatesCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Foreground="#FF4CAF50"
                                    Margin="10 0 0 0"
                                    Width="166"/>

                            <Button Command="{Binding DataContext.DeleteGameSystem, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"
                                    Style="{StaticResource MaterialDesignIconButton}"
                                    Foreground="#FFE53935"
                                    ToolTip="Удалить"
                                    Margin="5 0 0 0">
                                <materialDesign:PackIcon Kind="Delete" />
                            </Button>

                        </StackPanel>
                    </Grid>
                </Expander>

                <!-- Статистика -->
                <Expander Header="Статистика и аналитика" 
                          Tag="ChartLine"
                          Foreground="White"
                          Background="#FF2D2D30">
                    <StackPanel>
                        <!-- Общая статистика -->
                        <Grid Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" 
                                 Text="{Binding UserStatistics.TotalUsers, StringFormat='Всего пользователей: {0}'}"
                                 FontSize="16"
                                 FontWeight="Bold"/>

                            <TextBlock Grid.Row="1" 
                                 Text="{Binding UserStatistics.OnlineUsers, StringFormat='Онлайн: {0}'}"
                                 FontSize="16"
                                 Foreground="LimeGreen"
                                 Margin="0,10,0,0"/>

                            <TextBlock Grid.Row="2" 
                                 Text="{Binding UserStatistics.OfflineUsers, StringFormat='Оффлайн: {0}'}"
                                 FontSize="16"
                                 Foreground="LightGray"
                                 Margin="0,5,0,0"/>

                            <TextBlock Grid.Row="3"
                             Text="{Binding UserStatistics.LastUpdated, StringFormat='Обновлено: {0:HH:mm:ss}'}"
                             FontSize="12"
                             Foreground="Gray"
                             Margin="0,10,0,0"/>
                        </Grid>

                        <!-- Список активных пользователей -->
                        <TextBlock Text="Активные пользователи:" 
                                 FontSize="14" 
                                 FontWeight="Bold"
                                 Margin="10,15,10,5"/>
                        
                        <DataGrid ItemsSource="{Binding OnlineUsers}" 
                                AutoGenerateColumns="False"
                                MaxHeight="300"
                                Margin="10,0,10,10">
                            
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Пользователь" Binding="{Binding Username}"/>
                                <DataGridTextColumn Header="Последняя активность" 
                                        Binding="{Binding LastActivity, StringFormat='{}{0:dd.MM.yy HH:mm}'}"/>
                                <DataGridTemplateColumn Header="Статус" Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <Ellipse Width="10" Height="10" 
                                     Fill="{Binding IsOnline, Converter={StaticResource BoolToColorConverter}}"
                                     Margin="0,0,5,0"/>
                                                <TextBlock Text="{Binding IsOnline, Converter={StaticResource BoolToStatusConverter}}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Expander>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
