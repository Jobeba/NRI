<Window x:Class="NRI.DiceRoller"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:NRI.Classes"
        Title="Dice Roller" Height="600" Width="800"
        WindowStartupLocation="CenterScreen"
        Background="#FF2D2D30" Foreground="White">

    <!-- DataContext для привязки данных -->
    <Window.DataContext>
        <local:DiceRollerViewModel/>
    </Window.DataContext>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Панель управления -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10">
            <!-- Выбор типа кубика -->
            <ComboBox ItemsSource="{Binding DiceTypes}" 
                      SelectedItem="{Binding DiceType}" 
                      Width="100" 
                      Margin="5"
                      Style="{StaticResource ModernComboBox}" />

            <!-- Ввод количества кубиков -->
            <TextBox Text="{Binding DiceCount}" 
                     Width="100" 
                     Margin="5"
                     Style="{StaticResource ModernTextBox}" />

            <!-- Кнопка броска -->
            <Button Content="Бросить кубики" 
                    Command="{Binding RollDiceCommand}" 
                    Width="150" 
                    Margin="5"
                    Style="{StaticResource ModernButton}" />

            <!-- Кнопка очистки истории -->
            <Button Content="Очистить историю" 
                    Command="{Binding ClearHistoryCommand}" 
                    Width="150" 
                    Margin="5"
                    Style="{StaticResource ModernButton}" />
        </StackPanel>

        <!-- Результаты броска -->
        <Border Grid.Row="1" 
                Background="#FF1E1E1E" 
                CornerRadius="10" 
                Padding="10" 
                Margin="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Текущий результат -->
                <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,10">
                    <TextBlock Text="{Binding SelectedRoll.DiceType, StringFormat='Тип кубика: {0}'}" 
                               FontSize="16" 
                               FontWeight="Bold" />
                    <TextBlock Text="{Binding SelectedRoll.Sum, StringFormat='Сумма: {0}'}" 
                               FontSize="14" />
                    <ItemsControl ItemsSource="{Binding SelectedRoll.Results}" 
                             Margin="0,10,0,0">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <!-- Анимация для каждого значения -->
                                <Border Background="#FF007ACC" 
                                    CornerRadius="5" 
                                    Padding="10" 
                                    Margin="5">
                                    <TextBlock Text="{Binding}" 
                                           FontSize="24" 
                                           FontWeight="Bold" 
                                           Foreground="White">
                                        <TextBlock.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- Анимация вращения -->
                                                        <DoubleAnimation
                                        Storyboard.TargetProperty="(TextBlock.RenderTransform).(RotateTransform.Angle)"
                                        From="0" To="360" Duration="0:0:1" />
                                                        <!-- Анимация масштабирования -->
                                                        <DoubleAnimation
                                        Storyboard.TargetProperty="(TextBlock.RenderTransform).(ScaleTransform.ScaleX)"
                                        From="0.5" To="1" Duration="0:0:1" />
                                                        <DoubleAnimation
                                        Storyboard.TargetProperty="(TextBlock.RenderTransform).(ScaleTransform.ScaleY)"
                                        From="0.5" To="1" Duration="0:0:1" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </TextBlock.Triggers>
                                        <TextBlock.RenderTransform>
                                            <TransformGroup>
                                                <RotateTransform />
                                                <!-- Явно указываем RotateTransform -->
                                                <ScaleTransform />
                                                <!-- Явно указываем ScaleTransform -->
                                            </TransformGroup>
                                        </TextBlock.RenderTransform>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- История бросков -->
                <ListView Grid.Row="1" 
                          ItemsSource="{Binding RollHistory}" 
                          SelectedItem="{Binding SelectedRoll}" 
                          Background="Transparent" 
                          BorderThickness="0">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Background="#FF252526" 
                                    CornerRadius="5" 
                                    Padding="10" 
                                    Margin="0,5">
                                <StackPanel>
                                    <TextBlock Text="{Binding DiceType, StringFormat='Тип кубика: {0}'}" 
                                               FontSize="14" 
                                               FontWeight="Bold" />
                                    <TextBlock Text="{Binding Sum, StringFormat='Сумма: {0}'}" 
                                               FontSize="12" />
                                    <TextBlock Text="{Binding Results, StringFormat='Значения: {0}'}" 
                                               FontSize="12" />
                                    <TextBlock Text="{Binding Timestamp, StringFormat='Время: {0:HH:mm:ss}'}" 
                                               FontSize="12" 
                                               Foreground="Gray" />
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </Border>
    </Grid>
</Window>