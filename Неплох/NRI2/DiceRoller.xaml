<Window x:Class="NRI.DiceRoller"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:helix="http://helix-toolkit.org/wpf"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:NRI.Classes"
        Title="Dice Roller" Height="600" Width="800"
        WindowStartupLocation="CenterScreen"
        Background="#FF2D2D30" Foreground="White">

    <Window.DataContext>
        <local:DiceRollerViewModel />
    </Window.DataContext>

    <Window.Resources>
        
        <local:MillisecondsToTimeSpanConverter x:Key="MillisecondsToTimeSpanConverter" />
        <!-- Ресурсы для изображений кубиков -->
        <ImageSource x:Key="D4Image">image/D4.jpg</ImageSource>
        <ImageSource x:Key="D6Image">image/D6.jpg</ImageSource>
        <ImageSource x:Key="D8Image">image/D8.jpg</ImageSource>
        <ImageSource x:Key="D10Image">image/D10.jpg</ImageSource>
        <ImageSource x:Key="D12Image">image/D12.png</ImageSource>
        <ImageSource x:Key="D20Image">image/D20.jpg</ImageSource>
        <ImageSource x:Key="D100Image">image/D100.jpg</ImageSource>

        <!-- Шаблон для отображения кубиков -->
        <DataTemplate x:Key="DiceTemplate">
            <Border Background="Transparent" 
            Padding="5">
                <Image Source="{Binding ImageSource}" 
               Width="50" 
               Height="50">
                    <Image.RenderTransform>
                        <TransformGroup>
                            <RotateTransform />
                            <TranslateTransform />
                        </TransformGroup>
                    </Image.RenderTransform>
                    <Image.Triggers>
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard>
                                    <!-- Анимация падения -->
                                    <DoubleAnimation
                                Storyboard.TargetProperty="(Image.RenderTransform).(TransformGroup.Children)[1].(TranslateTransform.Y)"
                                From="-200" To="0" Duration="0:0:1">
                                        <DoubleAnimation.EasingFunction>
                                            <BounceEase Bounces="3" EasingMode="EaseOut" />
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <!-- Анимация вращения -->
                                    <DoubleAnimation
                                Storyboard.TargetProperty="(Image.RenderTransform).(TransformGroup.Children)[0].(RotateTransform.Angle)"
                                From="0" To="360" Duration="0:0:1" />
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </Image.Triggers>
                </Image>
            </Border>
        </DataTemplate>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Панель управления -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10">
            <ComboBox ItemsSource="{Binding DiceTypes}" 
                      SelectedItem="{Binding DiceType}" 
                      Width="100" 
                      Margin="5"
                      Style="{StaticResource ModernComboBox}" />

            <TextBox Text="{Binding DiceCount}" 
                     Width="100" 
                     Margin="5"
                     Style="{StaticResource ModernTextBox}"/>

            <Button Content="Бросить кубики" 
                    Command="{Binding RollDiceCommand}" 
                    CommandParameter="{Binding DiceType}" 
                    Width="150" 
                    Margin="5" 
                    Style="{StaticResource ModernButton}"/>

            <Button Content="Очистить историю" 
                    Command="{Binding ClearHistoryCommand}" 
                    Width="150" 
                    Margin="5" 
                    Style="{StaticResource ModernButton}"/>
        </StackPanel>

        <!-- Результаты броска -->
        <Border Grid.Row="1" 
                Background="#FF1E1E1E" 
                CornerRadius="10" 
                Padding="10" 
                Margin="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Текущий результат -->
                <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,10">
                    <TextBlock Text="{Binding SelectedRoll.DiceType, StringFormat='Тип кубика: {0}'}" 
                               FontSize="16" FontWeight="Bold" />
                    <TextBlock Text="{Binding SelectedRoll.Sum, StringFormat='Сумма: {0}'}" 
                               FontSize="14" />
                    <ItemsControl ItemsSource="{Binding SelectedRoll.DiceResults}" 
                                  Margin="0,10,0,0"
                                  ItemTemplate="{StaticResource DiceTemplate}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                </StackPanel>

                <!-- История бросков -->
                <ListView Grid.Row="1" 
                          ItemsSource="{Binding RollHistory}" 
                          SelectedItem="{Binding SelectedRoll}" 
                          Background="Transparent" 
                          BorderThickness="0">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Background="#FF252526" 
                                    CornerRadius="5" 
                                    Padding="10" 
                                    Margin="0,5">
                                <StackPanel>
                                    <TextBlock Text="{Binding DiceType, StringFormat='Тип кубика: {0}'}" 
                                               FontSize="14" FontWeight="Bold" />
                                    <TextBlock Text="{Binding Sum, StringFormat='Сумма: {0}'}" 
                                               FontSize="12" />
                                    <TextBlock Text="{Binding DiceResults, StringFormat='Значения: {0}'}" 
                                               FontSize="12" />
                                    <TextBlock Text="{Binding Timestamp, StringFormat='Время: {0:HH:mm:ss}'}" 
                                               FontSize="12" Foreground="Gray" />
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </Border>
    </Grid>
</Window>